<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>グッズ管理システム</title>
    
    <!-- iOS PWA 必備標籤 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="グッズ管理">
    
    <!-- App 圖示 (建議準備一張 192x192 的圖片網址) -->
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3081/3081913.png">

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #F2F2F7;
            -webkit-tap-highlight-color: transparent;
            /* 防止 iOS 橡皮筋效果拉動背景 */
            overscroll-behavior-y: none;
        }

        .ios-blur {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .modal-animate {
            animation: slideUp 0.3s ease-out;
        }

        /* 調整 PWA 下的頂部間距，避免擋到狀態欄 */
        @supports (-webkit-touch-callout: none) {
            .pwa-padding {
                padding-top: env(safe-area-inset-top);
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- アイコン組件 ---
        const SearchIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#8E8E93" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        );

        const AddIcon = () => (
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#007AFF" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        );

        // --- 初期データ ---
        const INITIAL_PRODUCTS = [
            { id: '1', name: 'フルカラーアクリルスタンド', category: 'アクリル', material: '3mm 透明アクリル', processing: '両面インクジェット印刷', memo: '第一弾予約商品。品質に注意。', series: '呪術廻戦', image: 'https://images.unsplash.com/photo-1613913317924-d2e8736f8613?w=400' },
            { id: '2', name: 'ブリキ缶バッジ', category: '缶バッジ', material: 'ブリキ / マットフィルム', processing: 'マットサンドラメ加工', memo: 'イベント限定版。安全ピン仕様。', series: 'SPY×FAMILY', image: 'https://images.unsplash.com/photo-1591543622403-108294b9359a?w=400' },
            { id: '3', name: '刺繍ベースボールキャップ', category: 'アパレル', material: '綿100% キャンバス', processing: '平刺繍', memo: 'ロゴの太さを調整。', series: 'オリジナル', image: 'https://images.unsplash.com/photo-1588850561407-ed78c282e89b?w=400' },
            { id: '4', name: 'セラミックマグカップ', category: '生活雑貨', material: '強化磁器', processing: '感温変色プリント', memo: 'お湯を入れると絵柄が出現。', series: 'ポケモン', image: 'https://images.unsplash.com/photo-1514228742587-6b1558fbed20?w=400' },
        ];

        const CATEGORIES = ['すべて', 'アクリル', '缶バッジ', 'アパレル', '生活雑貨', 'その他'];

        function App() {
            const [products, setProducts] = useState(INITIAL_PRODUCTS);
            const [searchQuery, setSearchQuery] = useState('');
            const [activeTab, setActiveTab] = useState('すべて');
            const [scrolled, setScrolled] = useState(false);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingProduct, setEditingProduct] = useState(null);

            useEffect(() => {
                const handleScroll = () => setScrolled(window.scrollY > 20);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            const openModal = (product = null) => {
                setEditingProduct(product ? { ...product } : {
                    id: Date.now().toString(),
                    name: '',
                    category: 'アクリル',
                    series: '',
                    material: '',
                    processing: '',
                    memo: '',
                    image: 'https://images.unsplash.com/photo-1572375992501-4b0892d50c69?w=400'
                });
                setIsModalOpen(true);
            };

            const closeModal = () => setIsModalOpen(false);

            const handleSave = () => {
                if (!editingProduct.name) return;
                if (products.find(p => p.id === editingProduct.id)) {
                    setProducts(products.map(p => p.id === editingProduct.id ? editingProduct : p));
                } else {
                    setProducts([editingProduct, ...products]);
                }
                closeModal();
            };

            const handleDelete = () => {
                setProducts(products.filter(p => p.id !== editingProduct.id));
                closeModal();
            };

            const filteredProducts = products.filter(p => 
                (p.name.toLowerCase().includes(searchQuery.toLowerCase()) || p.series.toLowerCase().includes(searchQuery.toLowerCase())) &&
                (activeTab === 'すべて' || p.category === activeTab)
            );

            return (
                <div className="max-w-md mx-auto min-h-screen pb-24 bg-[#F2F2F7]">
                    {/* Header */}
                    <header className={`fixed top-0 left-0 right-0 z-40 transition-all duration-300 pwa-padding ${scrolled ? 'bg-white/80 ios-blur border-b border-gray-300 h-16' : 'bg-transparent h-28'}`}>
                        <div className="max-w-md mx-auto h-full px-4 flex items-end justify-between pb-2">
                            <h1 className={`font-bold transition-all duration-300 ${scrolled ? 'text-lg w-full text-center' : 'text-3xl'}`}>
                                グッズ管理
                            </h1>
                            {!scrolled && (
                                <button onClick={() => openModal()} className="text-blue-500 mb-1 active:opacity-50">
                                    <AddIcon />
                                </button>
                            )}
                        </div>
                    </header>

                    <main className="pt-32 px-4">
                        {/* Search Bar */}
                        <div className="bg-gray-200 rounded-xl flex items-center px-3 py-2 mb-4">
                            <SearchIcon />
                            <input 
                                className="bg-transparent border-none outline-none ml-2 text-[17px] w-full"
                                placeholder="検索..."
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                            />
                        </div>

                        {/* Tabs */}
                        <div className="flex overflow-x-auto hide-scrollbar gap-2 mb-6">
                            {CATEGORIES.map(tab => (
                                <button 
                                    key={tab}
                                    onClick={() => setActiveTab(tab)}
                                    className={`px-4 py-1.5 rounded-full text-sm font-semibold whitespace-nowrap transition-colors ${activeTab === tab ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-500'}`}
                                >
                                    {tab}
                                </button>
                            ))}
                        </div>

                        {/* Grid */}
                        <div className="grid grid-cols-2 gap-4">
                            {filteredProducts.map(product => (
                                <div 
                                    key={product.id} 
                                    onClick={() => openModal(product)}
                                    className="bg-white rounded-2xl overflow-hidden shadow-sm active:opacity-70 transition-opacity"
                                >
                                    <div 
                                        className="h-36 bg-cover bg-center bg-gray-100"
                                        style={{ backgroundImage: `url(${product.image})` }}
                                    />
                                    <div className="p-3">
                                        <span className="text-[10px] font-bold bg-blue-50 px-1.5 py-0.5 rounded text-blue-600">
                                            {product.series}
                                        </span>
                                        <h3 className="font-bold text-sm mt-1 truncate">{product.name}</h3>
                                        <p className="text-[11px] text-gray-400 mt-1 truncate">
                                            {product.category}
                                        </p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </main>

                    {/* Modal */}
                    {isModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-end">
                            <div className="absolute inset-0 bg-black/40" onClick={closeModal} />
                            <div className="relative w-full max-w-md mx-auto bg-[#F2F2F7] rounded-t-2xl h-[92vh] flex flex-col modal-animate overflow-hidden">
                                <div className="flex justify-between items-center px-4 py-3 bg-white border-b border-gray-300">
                                    <button onClick={closeModal} className="text-blue-500 text-lg">キャンセル</button>
                                    <h2 className="font-bold">商品情報</h2>
                                    <button onClick={handleSave} className="text-blue-500 font-bold text-lg">完了</button>
                                </div>
                                
                                <div className="flex-1 overflow-y-auto p-4">
                                    <div className="bg-white rounded-xl overflow-hidden mb-6">
                                        <div className="flex items-center px-4 py-3 border-b border-gray-100">
                                            <label className="w-24 text-gray-800">商品名</label>
                                            <input 
                                                className="flex-1 text-right outline-none"
                                                value={editingProduct.name}
                                                onChange={e => setEditingProduct({...editingProduct, name: e.target.value})}
                                                placeholder="未入力"
                                            />
                                        </div>
                                        <div className="flex items-center px-4 py-3 border-b border-gray-100">
                                            <label className="w-24 text-gray-800">作品名</label>
                                            <input 
                                                className="flex-1 text-right outline-none"
                                                value={editingProduct.series}
                                                onChange={e => setEditingProduct({...editingProduct, series: e.target.value})}
                                                placeholder="作品・シリーズ"
                                            />
                                        </div>
                                        <div className="flex items-center px-4 py-3">
                                            <label className="w-24 text-gray-800">カテゴリ</label>
                                            <select 
                                                className="flex-1 bg-transparent text-right outline-none appearance-none"
                                                value={editingProduct.category}
                                                onChange={e => setEditingProduct({...editingProduct, category: e.target.value})}
                                            >
                                                {CATEGORIES.filter(c => c !== 'すべて').map(c => <option key={c} value={c}>{c}</option>)}
                                            </select>
                                        </div>
                                    </div>

                                    <div className="bg-white rounded-xl p-4 mb-6">
                                        <label className="block text-gray-400 text-xs mb-2 uppercase">Memo</label>
                                        <textarea 
                                            className="w-full h-24 outline-none resize-none"
                                            value={editingProduct.memo}
                                            onChange={e => setEditingProduct({...editingProduct, memo: e.target.value})}
                                            placeholder="詳細メモ..."
                                        />
                                    </div>

                                    <button 
                                        onClick={handleDelete}
                                        className="w-full bg-white text-red-500 py-4 rounded-xl font-bold active:bg-gray-100"
                                    >
                                        削除
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Footer Nav */}
                    <nav className="fixed bottom-0 left-0 right-0 h-20 bg-white/80 ios-blur border-t border-gray-300">
                        <div className="max-w-md mx-auto h-full flex justify-around items-center pb-4 text-[10px] text-gray-400">
                            <div className="flex flex-col items-center text-blue-500">
                                <div className="w-6 h-6 mb-1 bg-blue-500 rounded-md"></div>
                                <span>一覧</span>
                            </div>
                            <div className="flex flex-col items-center">
                                <div className="w-6 h-6 mb-1 bg-gray-200 rounded-md"></div>
                                <span>製造</span>
                            </div>
                            <div className="flex flex-col items-center">
                                <div className="w-6 h-6 mb-1 bg-gray-200 rounded-md"></div>
                                <span>設定</span>
                            </div>
                        </div>
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
