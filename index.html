<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>グッズ管理システム</title>
    
    <!-- iOS PWA Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="グッズ管理">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3081/3081913.png">

    <!-- Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans JP", sans-serif;
            background-color: #F2F2F7;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
            margin: 0;
        }

        .ios-blur {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .modal-animate {
            animation: slideUp 0.3s ease-out;
        }

        .safe-top {
            padding-top: env(safe-area-inset-top);
        }

        /* 隱藏原生 file input */
        .file-input-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 圖示組件 ---
        const SearchIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#8E8E93" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        );

        const AddIcon = () => (
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#007AFF" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        );

        const CameraIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#007AFF" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
        );

        // --- 初期數據 ---
        const INITIAL_PRODUCTS = [
            { id: '1', name: 'フルカラーアクリルスタンド', category: 'アクリル', material: '3mm 透明アクリル', processing: '両面インクジェット印刷', memo: '第一弾予約商品。品質に注意。', series: '呪術廻戦', image: 'https://images.unsplash.com/photo-1613913317924-d2e8736f8613?w=400' },
            { id: '2', name: 'ブリキ缶バッジ', category: '缶バッジ', material: 'ブリキ / マットフィルム', processing: 'マットサンドラメ加工', memo: 'イベント限定版。安全ピン仕様。', series: 'SPY×FAMILY', image: 'https://images.unsplash.com/photo-1591543622403-108294b9359a?w=400' },
            { id: '3', name: '刺繍ベースボールキャップ', category: 'アパレル', material: '綿100% キャンバス', processing: '平刺繍', memo: 'ロゴの太さを調整。', series: 'オリジナル', image: 'https://images.unsplash.com/photo-1588850561407-ed78c282e89b?w=400' },
            { id: '4', name: 'セラミックマグカップ', category: '生活雑貨', material: '強化磁器', processing: '感温変色プリント', memo: 'お湯を入れると絵柄が出現。', series: 'ポケモン', image: 'https://images.unsplash.com/photo-1514228742587-6b1558fbed20?w=400' },
        ];

        const CATEGORIES = ['すべて', 'アクリル', '缶バッジ', 'アパレル', '生活雑貨', 'その他'];

        function App() {
            const [products, setProducts] = useState(INITIAL_PRODUCTS);
            const [searchQuery, setSearchQuery] = useState('');
            const [activeTab, setActiveTab] = useState('すべて');
            const [scrolled, setScrolled] = useState(false);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingProduct, setEditingProduct] = useState(null);
            const fileInputRef = useRef(null);

            useEffect(() => {
                const handleScroll = () => setScrolled(window.scrollY > 20);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            const openModal = (product = null) => {
                setEditingProduct(product ? { ...product } : {
                    id: Date.now().toString(),
                    name: '',
                    category: 'アクリル',
                    series: '',
                    material: '',
                    processing: '',
                    memo: '',
                    image: '' // 預設為空
                });
                setIsModalOpen(true);
            };

            const closeModal = () => setIsModalOpen(false);

            const handleSave = () => {
                if (!editingProduct.name) return;
                if (products.find(p => p.id === editingProduct.id)) {
                    setProducts(products.map(p => p.id === editingProduct.id ? editingProduct : p));
                } else {
                    setProducts([editingProduct, ...products]);
                }
                closeModal();
            };

            const handleDelete = () => {
                setProducts(products.filter(p => p.id !== editingProduct.id));
                closeModal();
            };

            // 處理本地圖片上傳
            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setEditingProduct({ ...editingProduct, image: reader.result });
                    };
                    reader.readAsDataURL(file);
                }
            };

            const filteredProducts = products.filter(p => 
                (p.name.toLowerCase().includes(searchQuery.toLowerCase()) || p.series.toLowerCase().includes(searchQuery.toLowerCase())) &&
                (activeTab === 'すべて' || p.category === activeTab)
            );

            return (
                <div className="max-w-md mx-auto min-h-screen pb-24 bg-[#F2F2F7]">
                    {/* Header */}
                    <header className={`fixed top-0 left-0 right-0 z-40 transition-all duration-300 safe-top ${scrolled ? 'bg-white/80 ios-blur border-b border-gray-300 h-16' : 'bg-transparent h-28'}`}>
                        <div className="max-w-md mx-auto h-full px-4 flex items-end justify-between pb-2">
                            <h1 className={`font-bold transition-all duration-300 ${scrolled ? 'text-lg w-full text-center' : 'text-3xl'}`}>
                                グッズ管理
                            </h1>
                            {!scrolled && (
                                <button onClick={() => openModal()} className="text-blue-500 mb-1 active:opacity-50">
                                    <AddIcon />
                                </button>
                            )}
                        </div>
                    </header>

                    <main className="pt-32 px-4">
                        {/* Search Bar */}
                        <div className="bg-gray-200 rounded-xl flex items-center px-3 py-2 mb-4">
                            <SearchIcon />
                            <input 
                                className="bg-transparent border-none outline-none ml-2 text-[17px] w-full"
                                placeholder="検索..."
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                            />
                        </div>

                        {/* Tabs */}
                        <div className="flex overflow-x-auto hide-scrollbar gap-2 mb-6">
                            {CATEGORIES.map(tab => (
                                <button 
                                    key={tab}
                                    onClick={() => setActiveTab(tab)}
                                    className={`px-4 py-1.5 rounded-full text-sm font-semibold whitespace-nowrap transition-colors ${activeTab === tab ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-500'}`}
                                >
                                    {tab}
                                </button>
                            ))}
                        </div>

                        {/* Grid */}
                        <div className="grid grid-cols-2 gap-4">
                            {filteredProducts.map(product => (
                                <div 
                                    key={product.id} 
                                    onClick={() => openModal(product)}
                                    className="bg-white rounded-2xl overflow-hidden shadow-sm active:opacity-70 transition-opacity"
                                >
                                    <div 
                                        className="h-36 bg-cover bg-center bg-gray-100 flex items-center justify-center text-gray-300"
                                        style={{ backgroundImage: product.image ? `url(${product.image})` : 'none' }}
                                    >
                                        {!product.image && <span className="text-xs">No Image</span>}
                                    </div>
                                    <div className="p-3">
                                        <span className="text-[10px] font-bold bg-blue-50 px-1.5 py-0.5 rounded text-blue-600">
                                            {product.series}
                                        </span>
                                        <h3 className="font-bold text-sm mt-1 truncate">{product.name}</h3>
                                        <p className="text-[11px] text-gray-400 mt-1 truncate">
                                            {product.category}
                                        </p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </main>

                    {/* Modal */}
                    {isModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-end">
                            <div className="absolute inset-0 bg-black/40" onClick={closeModal} />
                            <div className="relative w-full max-w-md mx-auto bg-[#F2F2F7] rounded-t-2xl h-[92vh] flex flex-col modal-animate overflow-hidden">
                                <div className="flex justify-between items-center px-4 py-3 bg-white border-b border-gray-300">
                                    <button onClick={closeModal} className="text-blue-500 text-lg">キャンセル</button>
                                    <h2 className="font-bold">商品情報</h2>
                                    <button onClick={handleSave} className="text-blue-500 font-bold text-lg">完了</button>
                                </div>
                                
                                <div className="flex-1 overflow-y-auto p-4">
                                    {/* 圖片上傳區塊 */}
                                    <div className="bg-white rounded-xl overflow-hidden mb-6 flex flex-col items-center p-4">
                                        <div 
                                            className="w-32 h-32 bg-gray-100 rounded-xl mb-3 bg-cover bg-center flex items-center justify-center border border-gray-100 overflow-hidden"
                                            style={{ backgroundImage: editingProduct.image ? `url(${editingProduct.image})` : 'none' }}
                                        >
                                            {!editingProduct.image && <CameraIcon />}
                                        </div>
                                        <div className="flex gap-2 w-full">
                                            <button 
                                                onClick={() => fileInputRef.current.click()}
                                                className="flex-1 bg-gray-100 text-blue-500 py-2 rounded-lg text-sm font-semibold active:opacity-60"
                                            >
                                                画像を選択
                                            </button>
                                            <input 
                                                type="file" 
                                                ref={fileInputRef}
                                                accept="image/*"
                                                className="file-input-hidden"
                                                onChange={handleImageUpload}
                                            />
                                        </div>
                                        <div className="w-full mt-3 pt-3 border-t border-gray-50">
                                            <input 
                                                className="w-full text-xs text-gray-400 bg-transparent outline-none"
                                                placeholder="または画像URLを貼り付け..."
                                                value={editingProduct.image.startsWith('data:') ? '' : editingProduct.image}
                                                onChange={e => setEditingProduct({...editingProduct, image: e.target.value})}
                                            />
                                        </div>
                                    </div>

                                    <div className="bg-white rounded-xl overflow-hidden mb-6">
                                        <div className="flex items-center px-4 py-3 border-b border-gray-100">
                                            <label className="w-24 text-gray-800">商品名</label>
                                            <input 
                                                className="flex-1 text-right outline-none"
                                                value={editingProduct.name}
                                                onChange={e => setEditingProduct({...editingProduct, name: e.target.value})}
                                                placeholder="未入力"
                                            />
                                        </div>
                                        <div className="flex items-center px-4 py-3 border-b border-gray-100">
                                            <label className="w-24 text-gray-800">作品名</label>
                                            <input 
                                                className="flex-1 text-right outline-none"
                                                value={editingProduct.series}
                                                onChange={e => setEditingProduct({...editingProduct, series: e.target.value})}
                                                placeholder="作品・シリーズ"
                                            />
                                        </div>
                                        <div className="flex items-center px-4 py-3">
                                            <label className="w-24 text-gray-800">カテゴリ</label>
                                            <select 
                                                className="flex-1 bg-transparent text-right outline-none appearance-none"
                                                value={editingProduct.category}
                                                onChange={e => setEditingProduct({...editingProduct, category: e.target.value})}
                                            >
                                                {CATEGORIES.filter(c => c !== 'すべて').map(c => <option key={c} value={c}>{c}</option>)}
                                            </select>
                                        </div>
                                    </div>

                                    <div className="bg-white rounded-xl p-4 mb-6">
                                        <label className="block text-gray-400 text-xs mb-2 uppercase">Memo</label>
                                        <textarea 
                                            className="w-full h-24 outline-none resize-none"
                                            value={editingProduct.memo}
                                            onChange={e => setEditingProduct({...editingProduct, memo: e.target.value})}
                                            placeholder="詳細メモ..."
                                        />
                                    </div>

                                    <button 
                                        onClick={handleDelete}
                                        className="w-full bg-white text-red-500 py-4 rounded-xl font-bold active:bg-gray-100 shadow-sm"
                                    >
                                        削除
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Footer Nav */}
                    <nav className="fixed bottom-0 left-0 right-0 h-20 bg-white/80 ios-blur border-t border-gray-300">
                        <div className="max-w-md mx-auto h-full flex justify-around items-center pb-4 text-[10px] text-gray-400">
                            <div className="flex flex-col items-center text-blue-500">
                                <div className="w-6 h-6 mb-1 bg-blue-500 rounded-md"></div>
                                <span>一覧</span>
                            </div>
                            <div className="flex flex-col items-center">
                                <div className="w-6 h-6 mb-1 bg-gray-200 rounded-md"></div>
                                <span>製造</span>
                            </div>
                            <div className="flex flex-col items-center">
                                <div className="w-6 h-6 mb-1 bg-gray-200 rounded-md"></div>
                                <span>設定</span>
                            </div>
                        </div>
                    </nav>
                </div>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
